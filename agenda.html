<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agenda</title>
    <link rel="stylesheet" href="style.css">
</head>
<h1>Agenda sua tarefa!</h1>

<body>
    <input id="tarefa" type="text" placeholder="Insira aqui sua tarefa"></input>
    <input id="seleciona-data" type="date" />
    <button onclick="adicionarTarefa()">Adicionar Tarefa</button>
    <div id="lista-de-tarefas"></div>


    <script>
        //sessão de modelagem
        let cocadaBoa;
        let afazeres;
        const afazeresSalvos = (localStorage.getItem("afazeres"));
        if(Array.isArray(afazeresSalvos )){
            afazeres = afazeresSalvos;
        }else{
        
        afazeres = [
            
        ];
    }

        //Salva as tarefas no navegador
        const salvarTarefas = () => localStorage.setItem("afazeres", JSON.stringify(afazeres));
        //console.log(JSON.sringify(afazeres));
        salvarTarefas();
        //MVC -> modelagem, vizualição e controle
        //Sessão de visualização
         const renderizar = () => {
            document.getElementById("lista-de-tarefas").innerHTML = "";
            afazeres.forEach(
                (tarefa) => {
                    const elemento = document.createElement("div");
                    elemento.innerHTML = tarefa.nome + " " + tarefa.data;

                    const botaoApagar = document.createElement("button");
                    botaoApagar.innerText = "Apagar"
                    botaoApagar.style = "margin-left: 12px;"
                    botaoApagar.id = tarefa.id;
                    botaoApagar.onclick = apagarTarefa;
                    elemento.appendChild( botaoApagar);

                    const listaDeTarefas = document.getElementById("lista-de-tarefas");
                    listaDeTarefas.appendChild(elemento);
                }
            );

        }

        const adicionarTarefa = () => {
            const campoTarefa = document.getElementById("tarefa");
            const tarefa = campoTarefa.value;

            const campoData = document.getElementById("seleciona-data");
            const prazo = campoData.value;

            const cron = "" + new Date().getTime();

            afazeres.push({
                nome: tarefa,
                data: prazo,
                id: cron
            });
            
            salvarTarefas();
            renderizar();
        }
        const apagarTarefa = (evento) => {
            const botaoApagar = evento.target;
            const idASerApagado = botaoApagar.id; 
            afazeres = afazeres.filter((tarefa) =>{
                if( tarefa.id === idASerApagado ){
                    return false;
                }else{
                    return true;
                }
        
            });
            salvarTarefas();    
            renderizar();
        };    

       
       
        renderizar();
    </script>
</body>

</html>